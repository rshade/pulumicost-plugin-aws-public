# Data Model: Canada and South America Region Support

**Branch**: `003-ca-sa-region-support` | **Date**: 2025-11-20

## Overview

This feature does not introduce new data models. It extends existing pricing data structures to support two additional AWS regions.

## Existing Entities (No Changes)

### PricingData

Regional pricing data embedded at build time.

**Structure**:
```json
{
  "region": "ca-central-1",
  "currency": "USD",
  "ec2": {
    "<instance_type>": {
      "instance_type": "string",
      "operating_system": "Linux",
      "tenancy": "Shared",
      "hourly_rate": "float64"
    }
  },
  "ebs": {
    "<volume_type>": {
      "volume_type": "string",
      "rate_per_gb_month": "float64"
    }
  }
}
```

**Usage**: Embedded via `//go:embed` into rawPricingJSON, parsed once on first access using sync.Once.

### ResourceDescriptor (Proto)

Input from gRPC requests - no changes.

**Fields**:
- `provider`: "aws"
- `resource_type`: "ec2", "ebs", etc.
- `sku`: Instance type or volume type
- `region`: "ca-central-1" or "sa-east-1" (new values)
- `tags`: Key-value pairs

### GetProjectedCostResponse (Proto)

Output from gRPC responses - no changes.

**Fields**:
- `unit_price`: Hourly rate (EC2) or GB-month rate (EBS)
- `currency`: "USD"
- `cost_per_month`: Calculated monthly cost
- `billing_detail`: Human-readable description

## New Data Files

### aws_pricing_ca-central-1.json

**Location**: `internal/pricing/data/aws_pricing_ca-central-1.json`
**Generated by**: `tools/generate-pricing --regions ca-central-1`
**Embedded by**: `internal/pricing/embed_cac1.go`

### aws_pricing_sa-east-1.json

**Location**: `internal/pricing/data/aws_pricing_sa-east-1.json`
**Generated by**: `tools/generate-pricing --regions sa-east-1`
**Embedded by**: `internal/pricing/embed_sae1.go`

## Build Tag to Region Mapping

| Build Tag | AWS Region | Binary Name |
|-----------|------------|-------------|
| region_cac1 | ca-central-1 | pulumicost-plugin-aws-public-ca-central-1 |
| region_sae1 | sa-east-1 | pulumicost-plugin-aws-public-sa-east-1 |

## Validation Rules

- **Region match**: ResourceDescriptor.region must match embedded pricing region
- **Valid resource_type**: Must be "ec2", "ebs", or stub services
- **Valid sku**: Must exist in pricing data for resource_type
- **Non-negative pricing**: All rates must be >= 0

## State Transitions

N/A - This feature involves stateless pricing lookups.

## Data Volume Assumptions

- **Pricing data size**: ~500KB per region (EC2 + EBS types)
- **Binary overhead**: ~16MB per region binary
- **Memory at runtime**: <50MB including parsed pricing indexes
